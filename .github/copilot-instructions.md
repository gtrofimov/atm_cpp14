# ATM C++14 Project - AI Coding Agent Instructions

## Architecture Overview

This is a **C++14 demonstration project** for an ATM system showcasing modern C++ features. The codebase is structured for **Parasoft C/C++test** integration (static analysis and code coverage).

**Core Components:**
- `ATM` - Main controller coordinating Bank and Display interactions
- `Bank` - Manages collection of Account objects
- `Account` - Handles individual account operations and transaction history
- `BaseDisplay` - Interface for user output (virtual methods)

**Key Design Patterns:**
- Accounts store transaction history as `std::vector<std::tuple<UserRequest, double>>` (mutable for getBalance tracking)
- Enum class `UserRequest` defines operation types (BALANCE, DEPOSIT, WITHDRAW, TRANSACTIONS)
- Template method `forEachTransaction<T>` uses lambda callbacks for iteration
- C++11/14 features: `= default`, `= delete`, `auto` return types, move constructors, trailing return types

## Build System & Workflows

### Standard Build (CMake)
```bash
cd atm_cpp14/
mkdir build && cd build
cmake ..
make clean all
# or verbose: make clean all VERBOSE=1
```

### Running Tests
```bash
# From build directory
ctest
# or directly: ./atm_gtest
```
GoogleTest integration via FetchContent (v1.15.0). Tests in `tests/gt/*.hpp` use `::testing::Test::RecordProperty` for traceability.

### Parasoft C/C++test Coverage
**Enable coverage instrumentation:**
```bash
cmake -DCPPTEST_COVERAGE=ON ..
make
./atm_gtest  # Run tests to generate .clog file
make cpptestcov-compute  # Compute coverage data to .coverage/
make cpptestcov-report   # Generate reports (txt/md/html)
```

**Coverage artifacts:**
- Runtime log: `build/cpptest-coverage/ATM_Cpp14_lib/*.clog`
- Coverage data: `.coverage/*.cov`
- Reports: `.coverage/coverage.{txt,md,html}`

**Coverage configuration** (in `cpptest-coverage.cmake`):
- Excludes: `tests/*`, `*_test.cpp`, `build/*`
- Types: Line, Statement, Branch, DC, SCC, MCDC, Function, Condition coverage
- Compiler: `gcc_13-64`

## Code Conventions

### File Organization
- Headers: `include/*.hxx` (not `.h`)
- Sources: `src/*.cxx` (not `.cpp`)
- Tests: `tests/gt/*Test.hpp` (GoogleTest), `tests/autogenerated/*` (Parasoft-generated)
- Build output: `build/` directory

### C++14 Features in Use
- Deleted functions: `Account(const Account&) = delete;`
- Default constructors: `Account() = default;`
- Auto return types: `auto getBalance() const { return myBalance; }`
- Trailing return types: `auto getAccount(...) -> Account*;`
- Lambda expressions with capture: `[this] (...) { ... }`
- Move semantics: `Account(Account&&);`

### Naming Conventions
- Member variables: `myVariableName` prefix
- Headers use include guards: `#ifndef ATM_HXX`
- Enum classes preferred over C-style enums

## Testing Conventions

**GoogleTest Structure:**
- Main entry: `tests/gt/gtest_main.cpp` includes all test headers
- Test files: `AccountTest.hpp`, `BankTest.hpp`, `BaseDisplayTest.hpp`
- Property tracking: `RecordProperty("req", "ATM_test-520")` for requirements traceability
- Property tracking: `RecordProperty("cpptest_filename", __FILE__)` for source location

**Common patterns:**
```cpp
TEST(Account, testName) {
  ::testing::Test::RecordProperty("req", "ATM_test-520");
  ::testing::Test::RecordProperty("cpptest_filename", __FILE__);
  // test body
}
```

## Parasoft Integration

**Configuration files in `conf/`:**
- `Build Test Executable Custom.properties` - 1600+ lines of rule configuration
- `Generate Unit Tests Custom.properties`
- `Run Unit Tests Custom.properties`
- `Load Test Results Custom.properties`

**CI Script (`jenkins/cpptest_run.sh`):**
1. Import project to workspace
2. Run static analysis: `builtin://AUTOSAR C++14 Coding Guidelines`
3. Run unit tests: `builtin://Run Unit Tests`
4. Generate reports to `reports/` directory

**Suppression file:** `src/parasoft.suppress` for static analysis violations

## Common Tasks

### Adding New Functionality
1. Add method declaration to `include/*.hxx`
2. Implement in `src/*.cxx`
3. Add tests in `tests/gt/*Test.hpp`
4. Rebuild and run: `make && ctest`

### Analyzing Coverage Gaps
```bash
# After running tests with CPPTEST_COVERAGE=ON
make cpptestcov-report
cat .coverage/coverage.txt  # View summary
# or open .coverage/coverage.html in browser
```

### Checking Static Analysis
Use Parasoft C/C++test CLI with AUTOSAR C++14 config or run via `jenkins/cpptest_run.sh`.

## Known Patterns & Idioms

- **Mutable transaction tracking**: `getBalance()` is const but adds to `mutable` transaction vector
- **Password validation**: `Bank::getAccount()` returns nullptr if password mismatch (uses `std::string::compare()`)
- **Resource management**: Bank owns Account pointers but destructor marked NYI (memory leak exists)
- **Display abstraction**: BaseDisplay provides interface; concrete implementations inject output behavior
